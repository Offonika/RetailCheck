PRD — «Чек-лист-бот для смен» (Telegram + Google Sheets)
1. Обзор
Цель: заменить Excel-чек-листы на пошаговый бот в Telegram. Сотрудник вводит суммы/галочки/фото, бот проверяет и пишет всё в Google Таблицу. Менеджер получает сводку и может выгружать отчёты за день/неделю.
Ключевая ценность: меньше ошибок и переписок, быстрый итог смены, единое место правды — Google Таблица.

2. Пользователи и роли
Сотрудник магазина — проходит чек-лист, прикладывает фото, комментирует расхождения.


Менеджер — запускает смену, получает сводку/файл, видит историю, может вернуть на доработку.


Бухгалтер/контролёр (опционально) — читает лист «Export».



3. Объём работ (MVP)
1–2 шаблона чек-листов (на старте «Вечерняя смена»: 11:00 / 16:00 / 19:00 / закрытие).


Типы шагов: число, текст, галочка, фото.


Проверки: формат числа, диапазоны/пределы, обязательность, комментарий при расхождении.


Итог смены: сводка в чат менеджеру + запись в Таблицу.


Напоминания по времени (11:00 / 16:00 / 19:00).


История смен и статусы: in_progress / done / returned.


Экспорт в лист «Export» (день/неделя) по кнопке.


Вне MVP (после пилота): автоподтяжка из 1С, веб-панель/дашборды, сложные права.

4. Пользовательские сценарии (flow)
4.1 Сотрудник
Получает кнопку «Начать смену» / приглашение на текущий магазин.


Видит «Шаг 1 из N»: подсказка, ввод значения (число/текст) или загрузка фото.


Если есть разница с нормой → бот показывает дельту и требует комментарий.


Кнопка «Далее» → следующий шаг. Разрешены «Назад» и «Пропустить» (если шаг необязательный).


«Итог» → бот показывает сводку и отправляет менеджеру, фиксирует done.


4.2 Менеджер
Команда «Создать смену» для магазина (или автосоздание по расписанию).


Получает напоминания (если шаги не выполнены к 11/16/19).


По завершении — сообщение-сводка + кнопка «Экспорт за день/неделю».


Может «Вернуть на доработку»: смена снова in_progress, у сотрудника открываются шаги с ошибками.



5. Правила и проверки
5.1 Ввод
Числа: только цифры и разделитель, автонормализация (запятая/точка), округление 2 знака.


Диапазоны: по шагу (напр., 0…200 000 ₽).


Фото: требуются для Z-отчёта/терминалов (проверка наличия).


Комментарий при расхождении: если |факт − норма| ≥ порога, поле «Комментарий» обязательно.


5.2 Дельты и нормы
Нормы задаются в шаблоне или вводятся «сверочной» суммой.


Дельта = факт − норма. Порог тревоги на проекте по умолчанию: 300 ₽ (меняемо).


5.3 Статусы и возврат
in_progress — смена в работе, доступны шаги.


done — все обязательные шаги закрыты, итог сформирован.


returned — менеджер вернул, обязательные «красные» шаги разблокированы.



6. Структура Google Таблицы (листы и поля)
Users
 user_id, tg_id, fio, role(employee|manager), shops(list), is_active, created_at
Shops
 shop_id, name, is_active
Templates
 template_id, name, version, is_active
TemplateSteps
 template_id, step_order, code, title, type(number|text|check|photo), required(bool), validators_json, norm_rule(optional)
Runs (инстанс смены)
 run_id, date, shop_id, template_id, started_by, status(in_progress|done|returned), version, created_at, finished_at
RunSteps
 run_id, step_code, value_number, value_text, value_check(bool), delta_number, comment, status(ok|error|pending), updated_at, idempotency_key
Attachments
 run_id, step_code, telegram_file_id, kind(z_report|pos_receipt|other), created_at
Audit
 ts, user_id, action, entity(run|run_step), entity_id, details
Export
 — формируемый лист с плоскими строками для отчёта (фильтры: дата/магазин/статус).
Технические приёмы:
Все записи — пакетно; проверка дублей по idempotency_key.


Поле version в Runs (оптимистичная блокировка).


Ретраи при 429/5xx (экспоненциально).



7. Напоминания
По магазинам в 11:00 / 16:00 / 19:00: если в Runs за сегодня есть in_progress и не закрыты обязательные шаги, отправить gentle-reminder сотрудникам этого магазина.


При |дельта| ≥ порога — уведомить менеджера магазина.



8. Сообщения/UX (примеры)
Шаг (число):
 «Шаг 3 из 18 — Касса 16:00. Введите сумму, ₽»
 — при ошибке: «Нужно число от 0 до 200 000».
 — при расхождении: «Разница −120 ₽. Напишите коротко причину.»
Шаг (фото):
 «Загрузите фото Z-отчёта. Можно несколькими сообщениями, затем нажмите “Далее”.»
Итог:
 «Смена Магазин-А за 12.11: касса 11:00/16:00/19:00, терминалы: Сбер/Т-банк.
 Итоговая дельта: −120 ₽ (комментарий: возврат покупателя).
 Отчёт записан в Таблицу. Менеджеру отправлена сводка.»

9. Нефункциональные требования
Надёжность: сохранение не теряется при кратковременных сбоях (ретраи).


Производительность: ответ бота ≤ 1,5 с на обычный шаг, ≤ 5 с на шаги с записью фото/пакетной записью в Таблицу.


Доступность: 99%+ в рабочие часы.


Безопасность: доступ к Таблице — только сервисному аккаунту; токены вне репо; whitelist пользователей.


Логи/аудит: запись ключевых действий в лист Audit.



10. Принятие (Acceptance Criteria)
Сотрудник проходит все обязательные шаги и закрывает смену без Excel.


В Таблице корректно создаются строки в Runs, RunSteps, Attachments.


Итог и алерты приходят менеджеру.


Напоминания приходят вовремя магазинам с незавершённой сменой.


Экспорт «за день/неделю» формируется в лист Export и совпадает с данными шагов.


При |дельта| ≥ порога комментарий обязателен — без него «Итог» недоступен.



11. Метрики успеха
≥ 90% смен закрываются в боте без ручной переписки.


≤ 1% ошибок ввода (неверный формат/пустые обязательные поля).


−30% времени на закрытие смены vs текущий Excel-процесс.



12. Сроки и этапы
День 1–3: шаблон Таблицы, доступы, прототип бота на одном шаблоне.


Неделя 1: все типы шагов, валидации, дельты, фото, итог.


Неделя 2: напоминания, статусы/возврат, экспорт, аудит, полировка.


Неделя 3: пилот на 3 магазинах, правки.
 Итого до пилота: ~2,5–3,5 недели.



13. Оценка трудозатрат и бюджета (ориентир)
MVP: ~140–180 ч → 350–540 тыс. ₽ (2 500–3 000 ₽/ч).


Упрощённый старт: ~90–110 ч → 225–330 тыс. ₽.


Поддержка (опц.): 10 ч/мес → 25–30 тыс. ₽.



14. Риски и смягчение
Квоты/лимиты Google: пакетные записи, очереди и ретраи.


Одновременная работа: idempotency_key + version в Runs.


Длинные чек-листы: разделы и прогресс, необязательные шаги можно «Пропустить».


Человеческий фактор: обязательные поля + возврат на доработку.



15. Открытые вопросы (для заказчика)
Финальный список шагов для первого шаблона и обязательность каждого.


Нормы/правила сверки (где пороги, где строго 0).


Список магазинов и менеджеров (Telegram-ники/ID).


Времена напоминаний (по умолчанию 11:00 / 16:00 / 19:00).


Порог тревоги по дельте (по умолчанию 300 ₽).



